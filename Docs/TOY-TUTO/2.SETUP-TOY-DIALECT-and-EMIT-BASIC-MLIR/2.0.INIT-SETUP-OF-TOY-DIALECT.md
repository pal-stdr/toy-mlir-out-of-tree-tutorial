# Initializing the Setup of TOY `Dialect` + `Ops`

- For what & why of `MLIR` - [Docs/MLIR-KNOWLEDGE-BASE/1.WHAT-WHY-OF-MLIR.md](../../MLIR-KNOWLEDGE-BASE/1.WHAT-WHY-OF-MLIR.md)
- A short intro to `MLIR` Dialect - [Docs/MLIR-KNOWLEDGE-BASE/2.WHAT-IS-DIALECT.md](../../MLIR-KNOWLEDGE-BASE/2.WHAT-IS-DIALECT.md)


- **I WILL STRONGLY RECOMMEND TO READ [Chapter 2: Emitting Basic MLIR](https://mlir.llvm.org/docs/Tutorials/Toy/Ch-2/) FROM BEGINNING UNTIL THE END OF THE [Using the Operation Definition Specification (ODS) Framework](https://mlir.llvm.org/docs/Tutorials/Toy/Ch-2/#using-the-operation-definition-specification-ods-framework) SECTION THOROUGHLY. THEN START FOLLOWING THE REST OF THIS DOC.**


# Why do we need to define `Dialect`?

Until now, we have done upto the `AST` generation for our Toy language. <ins>**To interface that toy `AST` with `MLIR`, we have to define a new Toy `Dialect`.** This dialect will model the structure of the Toy language, as well as provide an easy avenue for high-level analysis and transformation.

# Objectives

- **Define a `ToyDialectBase` from where we will start to extend the `ToyOps`**
- **Section 1 discusses, how to play with the code assets for Dialects at `tools/toy-compiler/include/` dir; including `CMake` configs**
- **Section 2 discusses, how to play with the code assets for Dialects at `tools/toy-compiler/lib/` dir; including `CMake` configs**
- **Section 3 discusses, how to update the main CMake config (i.e. `tools/toy-compiler/CMakeLists.txt`) for the things done in Section 1 & Section 2.**
- **Section 4 discusses, how the Dialect files (i.e. `.td`) are managed by MLIR infrastructure.**
- **Section 5 shows, the updated scaffold of `tools/toy-compiler` dir.**
- **(Optional) Section 6 includes the scaffold of `build/tools/toy-compiler/include` dir to show where can be the autogenerated headers (i.e. `ToyDialectBase.h.inc` & `ToyDialectBase.cpp.inc`) are found.**


# Resources

Codes are collected from `llvm-18-src-build/mlir/examples/toy/Ch2`


# 1. Manage Header + Dialect files at `tools/toy-compiler/include/` dir

## 1.1. Create `Dialect/ToyDialect/` dirs at `tools/toy-compiler/include/`

This is where the `ToyDialectBase.h` and `ToyDialectBase.td` will be created and populated. 

```sh
mkdir -p tools/toy-compiler/include/Dialect/ToyDialect
```

## 1.2. Now create `ToyDialectBase.td` at `tools/toy-compiler/include/Dialect/ToyDialect/`

```sh
touch tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.td
```

## 1.3. Now let's put the following content inside `tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.td`

```js
// Provide a definition of the 'toy' dialect in the ODS framework so that we
// can define our operations.
def Toy_Dialect : Dialect {
    let name = "toy";
    let summary = "A high-level dialect for analyzing and optimizing the Toy language";

    // A much longer description of our dialect.
    let description = [{
        The Toy language is a tensor-based language that allows you to define functions, perform some math computation, and print results. This dialect provides a representation of the language that is amenable to analysis and optimization.
    }];

    let cppNamespace = "::mlir::toy";
}


//===----------------------------------------------------------------------===//
// Base Toy operation definition.
//===----------------------------------------------------------------------===//

// Base class for toy operations extended from ToyDialect. This dialect inherits from the base
// `Op` class in OpBase.td, and provides:
//   * The parent dialect of the operation.
//   * The mnemonic for the operation, or the name without the dialect prefix.
//   * A list of traits for the operation.
class Toy_Op<string mnemonic, list<Trait> traits = []> :
    Op<Toy_Dialect, mnemonic, traits>;
```


### 1.3.1. What is `ToyDialectBase.td` & Why?

`ToyDialectBase.td` is a file where you will define your `Dialect` in `declarative` manner. From the name (i.e. `ToyDialectBase`) you can guess, this holds the Base (i.e. main) `Dialect` declaration + definition for `Toy` lang. Later all the `Ops` will be extended from this file.

In short, `ToyDialectBase.td` is a `TableGen` file which will hold the base class for `Toy Ops` in [`ODS` format](https://mlir.llvm.org/docs/DefiningDialects/Operations/). And using this `ODS` format in `TableGen` file, Dialects can be declared in a `Declarative Way`. **Why?** We will learn that in section `1.3.5.`.



### 1.3.2. So... What is `Dialect`?

- **Dialects are the `containers` of `rules` & `specifications` for modeling the structure of a language AST to `IR`. Not just only that, a Dialect can transform other Dialect too 😮.**

- Dialect can be also written for `IR` to `IR`. This is called IR translation or IR lowering. IR translation is the process of converting IR from one dialect to another.

- MLIR is designed to allow all IR elements, such as `attributes`, `operations`, and `types`, to be customized for a Dialect.


### 1.3.3 Typical `specifications` of a Dialect
- `name` of the Dialect.
- `Description` of the Dialect.
- `type` of input arguments.
- `type` of output/`return`.
- Defining `Ops` (For this, we will use `ODS` framework)
- etc.


### 1.3.4. Inside a Dialect, we have MLIR Operations a.k.a. `Ops`

Do you see the following lines at the end of the code added in section `1.3.`?

```js
//===----------------------------------------------------------------------===//
// Base Toy operation definition.
//===----------------------------------------------------------------------===//

// Base class for toy operations for ToyDialect. This dialect inherits from the base
// `Op` class in OpBase.td, and provides:
//   * The parent dialect of the operation.
//   * The mnemonic for the operation, or the name without the dialect prefix.
//   * A list of traits for the operation.
class Toy_Op<string mnemonic, list<Trait> traits = []> :
    Op<Toy_Dialect, mnemonic, traits>;
```

This is the `Toy_Op` class extended from core `Toy_Dialect` class.

A typical `Ops` (example purpose) may looks like following

```mlir
%4 = "toy.constant"() {value = dense<1.0> : tensor<2x3xf64>} : () -> tensor<2x3xf64>
```
**`Ops` are the building block of a Dialect. And the `specification` shown in `1.3.3.` section, is the format of defining `Ops`**



### 1.3.5. So why this weird `syntax` for a `Dialect`? Language or Frameworks used for defining a Dialect

**<ins>1.3.5.1. Language or Frameworks for Dialect</ins>:**
- <ins>Dialects can be defined using **C++**. But MLIR also supports defining dialects declaratively via [LLVM TableGen](https://llvm.org/docs/TableGen/ProgRef.html).</ins>
- **Those `.td` files will be automatically converted to `C++` headers (i.e. `.h` files) + Definitions (i.e. `.cpp` files) while building `toy-compiler` binary.**

**<ins>1.3.5.2. Why declarative dialect rather than using `C++`?</ins>**
- **Using the declarative specification is much cleaner as it removes the need for a large portion of the boilerplate when defining a new dialect.**
- **It also enables easy generation of dialect documentation, which can be described directly alongside the dialect.**


**<ins>1.3.5.3. More about `.td` format for defining `Ops` for a `Dialect`</ins>:**

- **`Ops` are the building block of a Dialect.** `Ops` can be defined by `C++` or [TableGen](https://llvm.org/docs/TableGen/ProgRef.html). **But here the MLIR org suggests to use a framework called [Operation Definition Specification (ODS)](https://mlir.llvm.org/docs/DefiningDialects/Operations/). So that means, `Ops` can be defined using the [`ODS` format](https://mlir.llvm.org/docs/DefiningDialects/Operations/) inside `TableGen` files (i.e. `.td` files).** FYI, `ODS` format specifications are defined by [ODS Framework](https://mlir.llvm.org/docs/DefiningDialects/Operations/).

- **Why `ODS`? 🤔**

Let's read what the official doc says

> Facts regarding an operation are specified concisely into a TableGen record, which will be expanded into an equivalent `mlir::Op` C++ template specialization at compile time. **Using the ODS framework is the desired way for defining operations in MLIR given the simplicity, conciseness, and general stability in the face of C++ API changes**.

So the last sentence is very important 🤔. Especially the part, where it says - **"general stability in the face of C++ API changes"**.


**<ins>1.3.5.4. So the `ODS` & `TableGen` formats are different? It's pretty confusing!! No? 🤔</ins>:**

`ODS` and `TableGen` both are tools used to define MLIR dialects. However, they have different strengths and weaknesses.

`ODS` is a more modern and flexible approach to defining MLIR dialects. It is based on a type system that is more expressive than the `type` system used by `TableGen`. This allows `ODS` to define more complex and powerful dialects. `ODS` is also more modular than `TableGen`, which means that it is easier to break down complex dialects into smaller, more manageable pieces.

`TableGen` is a legacy tool that is still widely used to define MLIR dialects. **It is a simpler and more streamlined approach than `ODS`. This makes it easier to learn and use, and it is also more efficient for defining simple dialects. However, `TableGen` is not as expressive or flexible as `ODS`, and it is more difficult to break down complex dialects into smaller pieces.**

**So which one to use?**
- `ODS` is a better choice for defining complex MLIR dialects that need to be highly expressive and modular. **`ODS` will be used to write Toy Dialect.**
- `TableGen` is a better choice for defining simple MLIR dialects that need to be easy to learn and use.


## 1.4. Now create `ToyDialectBase.h` at `tools/toy-compiler/include/Dialect/ToyDialect/`

`ToyDialectBase.h` will be used to `#include` the **autogenerated** class declaration of the `ToyDialect`. This autogeneration will be triggered from `toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt`. How to do trigger? We will learn that in section `1.6.2.`.

```sh
touch tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.h
```

## 1.5. Now let's put the following content inside `tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.h`

Read the comments and you will understand 😉.

```C++
#ifndef MLIR_TUTORIAL_TOY_DIALECT_H_
#define MLIR_TUTORIAL_TOY_DIALECT_H_

#include "mlir/IR/Dialect.h"


/// Include the auto-generated header file containing the declaration of the toy dialect.
#include "Dialect/ToyDialect/ToyDialectBase.h.inc"


/// To-do: Include the auto-generated header file containing the declarations of the
/// toy operations.

#endif // MLIR_TUTORIAL_TOY_DIALECT_H_
```


## 1.6. Now it's time to do the `CMake` config to autogenerate the `ToyDialectBase.h.inc` & `ToyDialectBase.cpp.inc`. Start configuring `CMake` considering `tools/toy-compiler/include/` dir

**Now we need to make the CMake mechanism to trigger the **autogeneration** of `C++` class declaration + definitions as `ToyDialectBase.h.inc` & `ToyDialectBase.cpp.inc`.**


[Note: I will Highly recommend to read the section **2.1. add_subdirectory():** from [Docs/MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md](../../MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md). The thing I am going to do here, explained in very very vast details there.]


### 1.6.1 Create `CMakeLists.txt` at `tools/toy-compiler/include/Dialect/ToyDialect/` dir.

```sh
touch tools/toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt
```

### 1.6.2. Now populate `tools/toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt` with following cmake `commands()`

```cmake
set(LLVM_TARGET_DEFINITIONS ToyDialectBase.td)
mlir_tablegen(ToyDialectBase.h.inc -gen-dialect-decls)
mlir_tablegen(ToyDialectBase.cpp.inc -gen-dialect-defs)
# To-do: tablegen for ToyOps declarations & definitions



# Defining the target alias "ToyCh2OpsIncGen". This alias will be called as a dependency to tools/toy-compiler/lib/Dialect/ToyDialect/ToyDialectBase.cpp

# Means, before the actual compilation starts, all the mlir_tablegen() commands will be executed by cmake; in order to produce those .h.inc, .cpp.inc type headers.

# They will be generated at build/tools/toy-compiler/include/Dialect/ToyDialect/ dir. Donot be confused.

# That's why we have to point this include location at "tools/toy-compiler/CMakeLists.txt" as "include_directories("${STANDALONE_BINARY_DIR}/tools/toy-compiler/include")"
add_public_tablegen_target(ToyCh2OpsIncGen)
```

- **When the CMake `mlir_tablegen()` functions will be executed, those auto generated headers will be dumped at `build/tools/toy-compiler/include/Dialect/ToyDialect/`**

**Things to do later:**

- Auto generated headers will be dumped at `build/tools/toy-compiler/include/Dialect/ToyDialect/`.

- The main CMake config file for our toy compiler (i.e. `tools/toy-compiler/CMakeLists.txt`) has to know this header include path as the argument for it's `-I` flag.

- So we have to add `include_directories("build/tools/toy-compiler/include/")` at `tools/toy-compiler/CMakeLists.txt` later. See at section `3.2.4.`

- Here you can ask, the autogenerated headers are dumped at `build/tools/toy-compiler/include/Dialect/ToyDialect/`. So I should include this one. Then why am I including `build/tools/toy-compiler/include/`? Nice question 😉. This is because, if later I add more Dialects, I donot have to specify their paths using `include_directories()` again and again. And to maintain that, in all Dialect `.h` + `.cpp` files (i.e. `ToyDialectBase.h`, `ToyDialectBase.cpp`), we have to call `#include` as relative path like `#include Dialect/ToyDialect/ToyDialectBase.h.inc`, `#include Dialect/ToyDialect/ToyDialectBase.h`, or `#include Dialect/ToyDialect/ToyDialectBase.cpp.inc`. So now if you concatenate, it would be like this **`build/tools/toy-compiler/include/` + `Dialect/ToyDialect/ToyDialectBase.h` = `build/tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.h` 😁**


### 1.6.3. Create `CMakeLists.txt` at `tools/toy-compiler/include/Dialect` dir.

Because, step by step we have to create the cmake config connection to the outward dir nest, so that the settings in `tools/toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt` can be recognized/detected by, first `tools/toy-compiler/include/Dialect/CMakeLists.txt`, then `tools/toy-compiler/include/CMakeLists.txt`, and finally by `tools/toy-compiler/CMakeLists.txt`.

- Create `CMakeLists.txt` at `tools/toy-compiler/include/Dialect/`

```sh
touch tools/toy-compiler/include/Dialect/CMakeLists.txt
```

- Now add inside `tools/toy-compiler/include/Dialect/CMakeLists.txt`

```cmake
add_subdirectory(ToyDialect)
```

### 1.6.4. Create `CMakeLists.txt` at `tools/toy-compiler/include/` dir.

Because, step by step we have to create the cmake config connection to the outward dir nest, so that finally `tools/toy-compiler/CMakeLists.txt` detect it.

- Create `CMakeLists.txt`

```sh
touch tools/toy-compiler/include/CMakeLists.txt
```

- Now add inside `tools/toy-compiler/include/CMakeLists.txt`

```cmake
add_subdirectory(Dialect)
```

**Done for `tools/toy-compiler/include/` part 😇**





# 2. Manage Header + Dialect files at `tools/toy-compiler/lib/` dir


## 2.1. Create dirs `Dialect/ToyDialect` at `tools/toy-compiler/lib/`

```sh
mkdir -p tools/toy-compiler/lib/Dialect/ToyDialect/
```

## 2.2. Create `ToyDialectBase.cpp` at `tools/toy-compiler/lib/Dialect/ToyDialect`

```sh
touch tools/toy-compiler/lib/Dialect/ToyDialect/ToyDialectBase.cpp
```

## 2.3. Populate `tools/toy-compiler/lib/Dialect/ToyDialect/ToyDialectBase.cpp` with `ToyDialect` init code

```C++
//===- ToyDialectBase.cpp - Toy IR Dialect registration in MLIR ------------------===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// This file initialize the ToyDialect for the Toy IR
//
//===----------------------------------------------------------------------===//

#include "Dialect/ToyDialect/ToyDialectBase.h"


using namespace mlir;
using namespace mlir::toy;

/// This .cpp file for declaring ToyDialectBase class is autogenerated by
/// CMake function (in include/Dialect/ToyDialect/CMakeLists.txt) using the flag
/// "-gen-dialect-defs". Without this file, we cannot initialize the Dialect.
/// ToyDialectBase instance will be owned by the mlir::MLIRContext.
#include "Dialect/ToyDialect/ToyDialectBase.cpp.inc"



//===----------------------------------------------------------------------===//
// ToyDialect
//===----------------------------------------------------------------------===//

/// Dialect initialization. This is the point of registration of types
/// and operations for the dialect.
void ToyDialect::initialize() {
    // To-do: Add autogenerated ToyOps declaration (i.e. ToyOps.cpp.inc)
}
```


## 2.4. Start configuring `CMake` considering `tools/toy-compiler/lib/Dialect/ToyDialect/` dir

### 2.4.1 Create `CMakeLists.txt` at `tools/toy-compiler/lib/Dialect/ToyDialect/` dir.

```sh
touch tools/toy-compiler/lib/Dialect/ToyDialect/CMakeLists.txt
```

### 2.4.2. Now populate `tools/toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt` with following cmake `command()`

```cmake
# "MLIRToyDialectCPP" is the alias through which tools/toy-compiler/CMakeLists.txt will target this lib
add_mlir_dialect_library(MLIRToyDialectCPP
    ToyDialectBase.cpp

    DEPENDS
    ToyCh2OpsIncGen # <= Telling cmake to generate .inc headers first. Add in Ch 2.0.
)
```

### 2.4.3 Create `CMakeLists.txt` at `tools/toy-compiler/lib/Dialect/` dir.

Because, step by step we have to create the cmake config connection to the outward dir nest, so that the settings in `tools/toy-compiler/lib/Dialect/ToyDialect/CMakeLists.txt` can be recognized/detected by, first `tools/toy-compiler/lib/Dialect/CMakeLists.txt`, then `tools/toy-compiler/lib/CMakeLists.txt`, and finally by `tools/toy-compiler/CMakeLists.txt`.

- Create `CMakeLists.txt` at `tools/toy-compiler/lib/Dialect/`

```sh
touch tools/toy-compiler/lib/Dialect/CMakeLists.txt
```

- Now add inside `tools/toy-compiler/lib/Dialect/CMakeLists.txt`

```cmake
add_subdirectory(ToyDialect)
```


### 2.4.4. Now update the `tools/toy-compiler/lib/CMakeLists.txt`

```cmake
add_subdirectory(toy-parser)

# Added in Ch 2.0.
add_subdirectory(Dialect)
```

**Done for `tools/toy-compiler/lib/Dialect` part 😇**


# 3. Now update the `tools/toy-compiler/CMakeLists.txt`

## 3.1. CMake config To-dos for the configs done in `/tools/toy-compiler/include`

- To point to the auto generated headers `ToyDialectBase.h.inc` & `ToyDialectBase.cpp.inc`, have to add `include_directories("${STANDALONE_BINARY_DIR}/tools/toy-compiler/include")`
- To trigger autogeneration commands in `tools/toy-compiler/include/Dialect/ToyDialect/CMakeLists.txt`, add `add_subdirectory("${TOY_INCLUDE_DIR}")` 

## 3.2. CMake config To-dos for the configs done in `/tools/toy-compiler/lib/Dialect/ToyDialect`
- `/tools/toy-compiler/lib/Dialect/ToyDialect/ToyDialectBase.cpp` is aliased as `MLIRToyDialectBaseCPP`. Add it to `SET(LIBS MLIRToyDialectBaseCPP)`

## 3.3. Final updated `tools/toy-compiler/CMakeLists.txt` will look like...

```cmake
# Set Toy Compiler binary filename
set(TOY_COMPILER_BIN_NAME "toy-compiler")


# "${CMAKE_CURRENT_SOURCE_DIR}" always reads where the current `CMakeLists.txt` is located
# Right now ${CMAKE_CURRENT_SOURCE_DIR} is called from this "/path/to/toy-mlir-out-of-tree-tutorial/tools/toy-compiler/CMakeLists.txt" file
# So, ${CMAKE_CURRENT_SOURCE_DIR} == ${TOY_MAIN_SRC_DIR} == /path/to/mlir-project/tools/toy-compiler


# Set all the required dirs
set(TOY_MAIN_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}")
set(TOY_INCLUDE_DIR "${TOY_MAIN_SRC_DIR}/include")
set(TOY_LIB_DIR "${TOY_MAIN_SRC_DIR}/lib")


# Point header files location (i.e. /path/to/mlir-project/tools/toy-compiler/include)
include_directories("${TOY_INCLUDE_DIR}")


# Added in Ch 2.0.
# ${STANDALONE_BINARY_DIR} == /path/to/mlir-project/build/
# Example case: For the auto gen ".inc" type headers like "ToyDialectBase.h.inc" at "tools/toy-compiler/include/Dialect/ToyDialect", the common location is - build/tools/toy-compiler/include/
include_directories("${STANDALONE_BINARY_DIR}/tools/toy-compiler/include")


# Added in Ch 2.0.
# We have to also add the "${TOY_INCLUDE_DIR}" as "add_subdirectory()"
# So now cmake will also treat this dir as subdirectory to run the commands()
# Read section "2.1. `add_subdirectory()`" from "Docs/MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md" to understand the details
add_subdirectory("${TOY_INCLUDE_DIR}")



# Point lib files location (i.e. /path/to/mlir-project/tools/toy-compiler/lib)
# Why use "add_subdirectory", go to "Docs/MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md" and read "2.1. add_subdirectory()"
add_subdirectory("${TOY_LIB_DIR}")


# add new lib `MLIRToyParser` (i.e. alias to `AST.cpp`)
set(LIBS
        MLIRToyParser
        MLIRToyDialectBaseCPP # <= Added in Ch 2.0
)


add_llvm_executable("${TOY_COMPILER_BIN_NAME}" toy-compiler.cpp)

# src- https://stackoverflow.com/a/71388662
# llvm_update_compile_flags adds -fno-exceptions to property COMPILE_FLAGS not COMPILE_DEFINITIONS
# Second, llvm_update_compile_flags inserts a space in front of the flag
llvm_update_compile_flags("${TOY_COMPILER_BIN_NAME}")

target_link_libraries("${TOY_COMPILER_BIN_NAME}" PRIVATE ${LIBS})

mlir_check_all_link_libraries("${TOY_COMPILER_BIN_NAME}")

install(TARGETS "${TOY_COMPILER_BIN_NAME}" DESTINATION bin)
```

**Done for updating `tools/toy-compiler/CMakeLists.txt` part 😇**





# 4. How MLIR infrastructure handles the Dialect (i.e. `.td`) files?

- As already discussed in section `1.3.5.3.`, we know `Dialects` & `Ops` are defined using [ODS Format](https://mlir.llvm.org/docs/DefiningDialects/Operations/) inside `TableGen` files (`.td` files). So `.td` files are the dialect files. And this is how `Ops` (i.e. `Operations`) are described in dialect.

- `.td` files are the src files from which we generate Dialect + Ops declarations (e.g. `ToyDialectBase.h.inc`) and definitions (e.g. `ToyDialectBase.cpp.inc`).

- Those header's are auto generated everytime we build `toy-compiler`. They are `C++` version of Dialect, that we have defined in `Dialect/ToyDialect/ToyDialectBase.td` TableGen using `ODS` format. This concept is execptionally handy, because the `clang++` compiler we currently using to build the `toy-compiler`, cannot compile `ToyDialectBase.td`. That's why, everytime we launch the build command through `build-mlir-18.sh`, those header's are autogenerated **on-the-fly** by CMake `mlir_tablegen()` command.

- Autogeneration could be triggered by other build system like `Bazel`. Just there we need to have a similar kind of function as like as `mlir_tablegen()`.

- `mlir-tblgen` command is used with different flags to generate Operation declarations, definitions, docs etc. Actually CMake `mlir_tablegen()` is a wrapper around `mlir-tblgen`. You can find it in your llvm src build bins dir (e.g. for our use case `$LLVM_PROJECT_ROOT/installation/bin/mlir-tblgen` or `$LLVM_PROJECT_ROOT/build/bin/mlir-tblgen`).

- to generate Dialect declarations, use `-gen-dialect-decls` flag and for definitions, use `gen-dialect-defs` flag.

- to generate operations declarations, use `-gen-op-decls` flag and for definitions, use `gen-op-defs` flag.

- To generate Dialect docs, use flag `-gen-dialect-doc`

- To generate Operation docs, use flag `-gen-op-doc`



## 4.1. Generate `Dialect` Declaration with flag `-gen-dialect-decls`

```sh
$LLVM_PROJECT_ROOT/installation/bin/mlir-tblgen -gen-dialect-decls tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.td -I $LLVM_PROJECT_ROOT/mlir/include/

# Returns
/*===- TableGen'erated file -------------------------------------*- C++ -*-===*\
|*                                                                            *|
|* Dialect Declarations                                                       *|
|*                                                                            *|
|* Automatically generated file, do not edit!                                 *|
|* From: ToyDialectBase.td                                                    *|
|*                                                                            *|
\*===----------------------------------------------------------------------===*/

namespace mlir {
namespace toy {

class ToyDialect : public ::mlir::Dialect {
  explicit ToyDialect(::mlir::MLIRContext *context);

  void initialize();
  friend class ::mlir::MLIRContext;
public:
  ~ToyDialect() override;
  static constexpr ::llvm::StringLiteral getDialectNamespace() {
    return ::llvm::StringLiteral("toy");
  }
};
} // namespace toy
} // namespace mlir
MLIR_DECLARE_EXPLICIT_TYPE_ID(::mlir::toy::ToyDialect)
```

## 4.2. Generate `Dialect` Definitions with flag `-gen-dialect-defs`

```sh
$LLVM_PROJECT_ROOT/installation/bin/mlir-tblgen -gen-dialect-defs tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.td -I $LLVM_PROJECT_ROOT/mlir/include/

# Returns
/*===- TableGen'erated file -------------------------------------*- C++ -*-===*\
|*                                                                            *|
|* Dialect Definitions                                                        *|
|*                                                                            *|
|* Automatically generated file, do not edit!                                 *|
|* From: ToyDialectBase.td                                                    *|
|*                                                                            *|
\*===----------------------------------------------------------------------===*/

MLIR_DEFINE_EXPLICIT_TYPE_ID(::mlir::toy::ToyDialect)
namespace mlir {
namespace toy {

ToyDialect::ToyDialect(::mlir::MLIRContext *context)
    : ::mlir::Dialect(getDialectNamespace(), context, ::mlir::TypeID::get<ToyDialect>()) {
  
  initialize();
}

ToyDialect::~ToyDialect() = default;

} // namespace toy
} // namespace mlir
```

## 4.3. Generate `Dialect` Docs with flag `-gen-dialect-doc`

```sh
$LLVM_PROJECT_ROOT/installation/bin/mlir-tblgen -gen-dialect-doc tools/toy-compiler/include/Dialect/ToyDialect/ToyDialectBase.td -I $LLVM_PROJECT_ROOT/mlir/include/

# Returns
<!-- Autogenerated by mlir-tblgen; don't manually edit -->
# 'toy' Dialect

A high-level dialect for analyzing and optimizing the Toy language
The Toy language is a tensor-based language that allows you to define functions, perform some math computation, and print results. This dialect provides a representation of the language that is amenable to analysis and optimization.

[TOC]
```


# 5. The following scaffold view will help you to understand very quickly.

- For details, please read section **2.1.2. How/Where should I use `add_subdirectory()`** from [Docs/MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md](Docs/MISCELLANEOUS/CMAKE-HOW-TO/CMAKE-KNOWLEDGE.md)

```sh
└── tools
    ├── CMakeLists.txt
    └── toy-compiler
        ├── CMakeLists.txt
        ├── include
        │   ├── CMakeLists.txt # <== Newly added
        │   ├── Dialect # <== Newly added
        │   │   ├── CMakeLists.txt
        │   │   ├── Ops.td
        │   │   └── ToyDialect
        │   │       ├── CMakeLists.txt # <== Newly added with ".inc" generator tablegen commands. Alias "ToyCh2OpsIncGen" is created for all those commands.
        │   │       ├── ToyDialectBase.h
        │   │       └── ToyDialectBase.td
        │   └── toy-analysis-parser # <== But it has no "CMakeLists.txt", because it has no purpose of gen of ".inc" type of header files
        │       ├── AST.h
        │       ├── Lexer.h
        │       └── Parser.h
        ├── lib
        │   ├── CMakeLists.txt
        │   ├── Dialect # <== Newly added
        │   │   ├── CMakeLists.txt
        │   │   └── ToyDialect
        │   │       ├── CMakeLists.txt # <== ToyDialectBase.cpp is calling the alias "ToyCh2OpsIncGen" as it's dependency to execute all tablegen commands first; before Dialect.cpp is called by final compile chain.
        │   │       └── ToyDialectBase.cpp
        │   └── toy-parser
        │       ├── AST.cpp
        │       └── CMakeLists.txt
        └── toy-compiler.cpp
```



## 6. Want to have a birds-eye-view where those `ToyDialectBase.h.inc` & `ToyDialectBase.cpp.inc` files generate? (Only Visualization purpose)

```sh
├── build
    ├── bin
    │   └── toy-compiler
.........
......
    └── tools
        ├── CMakeFiles
        ├── cmake_install.cmake
        └── toy-compiler
            ├── CMakeFiles
            │   └── toy-compiler.dir
            │       └── toy-compiler.cpp.o
            ├── cmake_install.cmake
            ├── include
            │   ├── CMakeFiles
            │   ├── cmake_install.cmake
            │   └── Dialect
            │       ├── CMakeFiles
            │       ├── cmake_install.cmake
            │       └── ToyDialect # <== This is where you can find your autogenerated header files
            │           ├── CMakeFiles
            │           ├── cmake_install.cmake
            │           ├── ToyDialectBase.cpp.inc
            │           ├── ToyDialectBase.cpp.inc.d
            │           ├── ToyDialectBase.h.inc
            │           └── ToyDialectBase.h.inc.d
            └── lib
                ├── CMakeFiles
                ├── cmake_install.cmake
                ├── Dialect
                │   ├── CMakeFiles
                │   ├── cmake_install.cmake
                │   └── ToyDialect
                │       ├── CMakeFiles
                │       └── cmake_install.cmake
                └── toy-parser
                    ├── CMakeFiles
                    │   ├── MLIRToyParser.dir
                    │   └── obj.MLIRToyParser.dir
                    └── cmake_install.cmake


```